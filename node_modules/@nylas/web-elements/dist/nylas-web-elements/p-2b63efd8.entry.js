import{r as t,c as s,h as i,H as e,a as h}from"./p-68c2fadf.js";import{N as n,e as a}from"./p-39aa2263.js";import{a as r}from"./p-01e86103.js";import{N as o,a as c,b as d,c as u,C as l,d as f,H as m}from"./p-8f88a748.js";import"./p-cb65c223.js";import"./p-cabb2e68.js";class p{constructor(t,s,i,e){this.router=t;this.nylasAuth=s;this.nylasAuthStore=i;this.nylasMailboxStore=e}init(){r("NylasMailboxConnector init")}get mailboxStore(){return this.nylasMailboxStore}get authStore(){return this.nylasAuthStore}get auth(){if(this._authConnector){return this._authConnector}this._authConnector=new o(this.nylasAuth,this.nylasAuthStore);return this._authConnector}get threads(){if(this._threadConnector){return this._threadConnector}this._threadConnector=new c(this.nylasAuth,this.nylasAuthStore,this.nylasMailboxStore,this.router);return this._threadConnector}get messages(){if(this._messageConnector){return this._messageConnector}this._messageConnector=new d(this.nylasAuth,this.nylasAuthStore,this.nylasMailboxStore);return this._messageConnector}get folders(){if(this._foldersConnector){return this._foldersConnector}this._foldersConnector=new u(this.nylasAuth,this.nylasAuthStore,this.nylasMailboxStore);return this._foldersConnector}getAuth(){return this.nylasAuth}resetStores(){this.nylasMailboxStore.reset();this.nylasAuthStore.reset()}async logout(){await this.nylasAuth.logout();this.resetStores()}}const y=":host{display:contents}";const b=y;const g=class{constructor(i){t(this,i);this.init=s(this,"init",7);this.loggedIn=s(this,"loggedIn",7);this.loggedOut=s(this,"loggedOut",7);this.handleAuthChange=async t=>{if(t){this.loggedIn.emit(this.host)}else{const t=this.loggedOut.emit(this.host);if(!t.defaultPrevented){await(this.nylasMailboxConnector?.logout())}}};this.automaticComponentRegistration=true;this.eventOverrides={};this.authConfig=undefined;this.defaultAuthStoreState=undefined;this.defaultMailboxStoreState=undefined}connectedCallback(){r("[nylas-mailbox] connectedCallback")}async componentWillLoad(){this.stores={auth:l(this.defaultAuthStoreState),mailbox:f(this.defaultMailboxStoreState)};this.baseProvider=new n(this.host,this.stores,this.automaticComponentRegistration,this.eventOverrides);this.router=new m;this.nylasAuth=a({apiUri:"https://api.us.nylas.com",elementsApiUri:"https://elements.us.nylas.com",storageType:"indexeddb",clientId:"YOUR_CLIENT_ID",defaultScopes:[],redirectURI:"/",...this.authConfig});const t=this.baseProvider?.getStore("auth");if(!t){throw new Error("Auth store is not defined")}const s=this.baseProvider?.getStore("mailbox");if(!s){throw new Error("Mailbox store is not defined")}this.nylasMailboxConnector=new p(this.router,this.nylasAuth,t,s);const i=this.init.emit(this.host);if(!i.defaultPrevented){await(this.nylasMailboxConnector?.auth.validateSession())}this.router?.addRouteChangeListener(`/thread/:threadId`,(async(t,s,i)=>{const e=i.threadId;const h=await(this.nylasMailboxConnector?.threads.getThread(e));if(h){this.nylasMailboxConnector?.mailboxStore.set("selectedThread",h)}}));this.router?.addRouteChangeListener(`/`,(async(s,i,e)=>{if(!t.state.isAuthenticated){return}this.nylasMailboxConnector?.threads.unSelectThread();this.nylasMailboxConnector?.folders.getFolders();const h=window.location.hash.split("?")[1];if(h){const t=new URLSearchParams(h);const s=t.get("query");if(s){await(this.nylasMailboxConnector?.threads.getThreads({search_query_native:s,page_token:undefined}))}}else{this.nylasMailboxConnector?.threads.getThreads()}}));this.router?.init();this.handleAuthChange(t.state.isAuthenticated);this.baseProvider?.componentWillLoad(this.nylasMailboxConnector)}async componentDidLoad(){const t=this.baseProvider?.getStore("auth");if(!t){throw new Error("Auth store is not defined")}t.onChange("isAuthenticated",this.handleAuthChange);this.baseProvider?.componentDidLoad()}componentDisconnected(){this.baseProvider?.componentDisconnected()}async registerComponentHandler(t){this.baseProvider?.registerComponent(t.detail)}async unregisterComponentHandler(t){this.baseProvider?.unregisterComponent(t.detail)}async getMailboxStore(){return this.baseProvider?.getStore("mailbox")}async getAuthStore(){return this.baseProvider?.getStore("auth")}async getNylasAuth(){return this.nylasAuth}async getNylasMailboxConnector(){return this.nylasMailboxConnector}render(){return i(e,{key:"662c4d3f763c5cf9db31c4d2ba26bcdf47ead164"},i("slot",{key:"5c2b75a569779dd2af6388648a4304721e82ba76"}))}get host(){return h(this)}};g.style=b;export{g as nylas_mailbox};
//# sourceMappingURL=p-2b63efd8.entry.js.map