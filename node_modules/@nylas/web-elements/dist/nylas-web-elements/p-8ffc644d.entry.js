import{h as e,F as t,r as n,c as s,H as i,a}from"./p-68c2fadf.js";import{N as o,n as r}from"./p-39aa2263.js";import{a as l,h as d}from"./p-01e86103.js";import{N as c,C as h,E as p}from"./p-ab09a78d.js";import"./p-cb65c223.js";import"./p-cabb2e68.js";class u{constructor({schedulerAPIURL:e,nylasSchedulerStore:t,sessionId:n,configId:s}){if(!e){throw new Error("schedulerAPIURL is required")}if(!t){throw new Error("nylasSchedulerStore is required")}if(!n&&!s){throw new Error("sessionId is required for private configs, if not config id is required for public configs")}if(e==="/"){const t=new URL(window.location.href);e=t.origin}this.configId=s;this.sessionId=n;this.schedulerAPIURL=e;this.nylasSchedulerStore=t}init(){l("NylasConnector init")}get schedulerStore(){return this.nylasSchedulerStore}get scheduler(){if(this._schedulerAPIConnector){return this._schedulerAPIConnector}this._schedulerAPIConnector=new c({schedulerAPIURL:this.schedulerAPIURL,schedulerStore:this.schedulerStore,sessionId:this.sessionId,configId:this.configId});return this._schedulerAPIConnector}resetStores(){this.nylasSchedulerStore.reset()}}const g=(n,s)=>{const i=n.isLoading;const a=n.showNotification;const o=n.nylasBranding;return e(t,null,a&&e("nylas-notification",null),i&&e("div",{class:"loading"},e("div",{class:"left"},e("div",{class:"skeleton"})),e("div",{class:"right"},e("div",{class:"skeleton"}),e("div",{class:"skeleton"}),e("div",{class:"skeleton"}),e("div",{class:"skeleton"}),e("div",{class:"skeleton"}))),!i&&s,e("div",{class:"footer"},o&&e(t,null,"Powered byÂ ",e("nylas-logo",null))))};const f=(t,n)=>e("div",{class:"message-banner"},n);const b=':host{display:flex;flex-direction:column;overflow:visible;border-radius:var(--nylas-border-radius-2x);width:fit-content;background:var(--nylas-base-0);position:relative;box-shadow:0px 4px 6px -2px rgba(0, 0, 0, 0.05), 0px 10px 15px -3px rgba(0, 0, 0, 0.1);--nylas-primary:#2563eb;--nylas-error:#cc4841;--nylas-error-pressed:#992222;--nylas-wraning:#f06c00;--nylas-success:#16a392;--nylas-info:#2b8fc2;--nylas-base-0:#ffffff;--nylas-base-25:#fcfcfd;--nylas-base-50:#f8f9fc;--nylas-base-100:#eaecf5;--nylas-base-200:#d5d9eb;--nylas-base-300:#b3b8d8;--nylas-base-400:#717bbc;--nylas-base-500:#4e5ba6;--nylas-base-600:#3e4784;--nylas-base-700:#263f72;--nylas-base-800:#293056;--nylas-base-900:#101323;--nylas-base-950:#0e101b;--nylas-border-radius:0.25rem;--nylas-border-radius-2x:0.5rem;--nylas-border-radius-3x:0.75rem;--nylas-font-family:"Inter", sans-serif;font-family:var(--nylas-font-family);font-optical-sizing:auto;font-style:normal;font-variation-settings:"slnt" 0}@media screen and (max-width: 768px){:host{width:auto;min-width:325px}}:root{font-family:inherit}.error{padding:8rem 12rem;color:var(--nylas-base-0);background-color:var(--nylas-error);margin:1.5rem;border-radius:var(--nylas-border-radius-2x)}.message-banner{text-align:right;color:var(--nylas-base-800);padding:1rem;border-bottom:1px solid var(--nylas-color-primary-200);margin-top:1rem}.loading{margin:1.5rem;display:flex;gap:1rem}.loading .skeleton{border-radius:var(--nylas-border-radius-2x);animation:pulsate 1.5s infinite}.loading .skeleton:nth-child(2){animation-delay:-100ms}.loading .skeleton:nth-child(3){animation-delay:-200ms}.loading .skeleton:nth-child(4){animation-delay:-300ms}.loading .skeleton:nth-child(5){animation-delay:-400ms}.loading .left .skeleton{height:100%;width:400px}.loading .right .skeleton{height:5rem;width:300px;margin-bottom:1rem}.loading .right .skeleton:last-child{margin-bottom:0}@keyframes pulsate{0%{background-color:var(--nylas-base-50)}50%{background-color:var(--nylas-base-100)}100%{background-color:var(--nylas-base-50)}}.select-date-page,.additional-data-page,.booked-event-page,.cancelled-event-page,.cancel-flow-page{border-top-left-radius:var(--nylas-border-radius-2x);border-top-right-radius:var(--nylas-border-radius-2x)}.select-date-page,.additional-data-page{display:flex}@media screen and (max-width: 768px){.select-date-page,.additional-data-page{flex-direction:column}}.booked-event-page{background-color:var(--nylas-base-50)}.cancelled-event-page,.cancel-flow-page{padding:1rem;height:496px;display:flex;justify-content:center;align-items:center}.booked-event-page,.cancelled-event-page,.cancel-flow-page{min-width:784px;background:var(--nylas-base-50)}@media screen and (max-width: 768px){.booked-event-page,.cancelled-event-page,.cancel-flow-page{min-width:90%}}.left-panel{padding:1rem 20px 0;gap:1rem;height:512px;min-width:384px;border-top-left-radius:inherit;background:var(--nylas-base-0)}@media screen and (max-width: 768px){.left-panel{border-top-right-radius:inherit;min-width:unset;height:auto}}@media screen and (max-width: 768px){.select-date-page .left-panel{padding:0.5rem 4px 0}}.border{margin-left:-20px;margin-right:-20px;border-top-width:1px;height:1px;background-color:var(--nylas-base-200)}@media screen and (max-width: 768px){.border{display:none}}.right-panel{min-width:360px;width:360px;background-color:var(--nylas-base-50);height:512px;padding-top:16px;border-left:1px solid var(--nylas-base-200);border-top-right-radius:inherit}@media screen and (max-width: 768px){.right-panel{border-top-right-radius:0px;width:inherit;min-width:unset;height:auto}}.right-panel h2{display:flex;margin:0;height:48px;gap:0.5rem;justify-content:center;align-items:center;width:auto;font-size:1.125rem;line-height:1.5rem;font-weight:500;text-align:center;color:var(--nylas-base-800)}.additional-data-page .left-panel{background-color:var(--nylas-base-50)}.additional-data-page .right-panel{background-color:var(--nylas-base-0)}nylas-selected-event-card{height:496px}@media screen and (max-width: 768px){nylas-selected-event-card{height:250px}}.footer{display:flex;justify-content:flex-end;align-items:center;padding:16px;font-size:14px;font-weight:300;color:var(--nylas-base-500);border-top:1px solid var(--nylas-base-200);min-height:24px}.footer svg{fill:var(--nylas-base-500)}.footer svg{margin-top:1px}nylas-selected-event-card::part(nsec__timezone){position:absolute;bottom:0}';const m=b;const y={title:"Something went wrong...",type:r.Error,category:p.Component};const v=class{constructor(e){n(this,e);this.init=s(this,"init",7);this.schedulerWillLoad=s(this,"schedulerWillLoad",7);this.schedulerDidLoad=s(this,"schedulerDidLoad",7);this.nylasSchedulerError=s(this,"nylasSchedulerError",7);this.mode="app";this.defaultSchedulerState=undefined;this.sessionId=undefined;this.schedulerApiUrl="https://api.us.nylas.com";this.bookingInfo=undefined;this.rescheduleBookingId=undefined;this.cancelBookingId=undefined;this.configurationId=undefined;this.nylasBranding=true;this.eventOverrides={};this.isLoading=undefined;this.themeConfig=undefined;this.showNotification=true;this.automaticComponentRegistration=true;this.selectedDateLabel=(new Date).toLocaleDateString(undefined,{dateStyle:"full"})||"No date selected"}connectedCallback(){l(`[nylas-scheduler] connectedCallback`)}async componentWillLoad(){l(`[nylas-scheduler] Component will load`);const e=this.schedulerWillLoad.emit(this.host);if(e.defaultPrevented){return}if(!this.checkIfSessionIdOrConfigIdExists()){return}this.stores={scheduler:h({bookingInfo:this.bookingInfo,nylasBranding:this.nylasBranding,...this.defaultSchedulerState})};this.baseProvider=new o(this.host,this.stores,this.automaticComponentRegistration,this.eventOverrides);const t=this.baseProvider?.getStore("scheduler");this.nylasSchedulerConnector=new u({schedulerAPIURL:this.schedulerApiUrl,sessionId:this.sessionId,configId:this.configurationId,nylasSchedulerStore:t});this.init.emit(this.host);this.baseProvider?.componentWillLoad(this.nylasSchedulerConnector);if(this.themeConfig){for(const[e,t]of Object.entries(this.themeConfig)){this.host.style.setProperty(`${e}`,t)}}}async componentDidLoad(){this.baseProvider?.componentDidLoad();if(!this.checkIfSessionIdOrConfigIdExists()){return}const e=await(this.nylasSchedulerConnector?.scheduler.getUISettings());if(!e||"error"in e){this.nylasSchedulerError.emit({...this.getErrorObject(e?.error)})}const t=this.baseProvider?.getStore("scheduler");const n=t?.get("configSettings")?.scheduler?.available_days_in_future;const s=t?.get("selectedTimeslot");if(s&&s?.start_time){if(!this.isTimeslotValid(s)){return}if(t?.get("showBookingForm")){t?.set("selectedDate",s.start_time);return}}const i=t?.get("selectedDate");const a=t?.get("availability");let o;if(a&&a.length>0){return}if(!i){const e=new Date;const{startTime:t,endTime:s,endTimeForAvailableDaysInFuture:i}=this.validateAvailableDaysInFuture(e,n||30);if(e.getTime()<i*1e3){o=await(this.nylasSchedulerConnector?.scheduler.getAvailability(t,s))}}else{const{startTime:e,endTime:t,endTimeForAvailableDaysInFuture:s}=this.validateAvailableDaysInFuture(i,n||30);if(i.getTime()<s*1e3){o=await(this.nylasSchedulerConnector?.scheduler.getAvailability(e,t))}}if(!o||"error"in o){this.nylasSchedulerError.emit({...this.getErrorObject(o?.error)})}if(!i){let e=new Date;const n=t?.get("availability").find((e=>new Date(e.start_time)>new Date));if(n){e=n.start_time}t?.set("selectedDate",e)}}componentDisconnected(){this.baseProvider?.componentDisconnected()}bookingInfoChanged(e){this.stores?.scheduler.set("bookingInfo",e)}async registerComponentHandler(e){this.baseProvider?.registerComponent(e.detail)}async unregisterComponentHandler(e){this.baseProvider?.unregisterComponent(e.detail)}async monthChangedHandler(e){const t=e.detail;const n=this.nylasSchedulerConnector?.schedulerStore?.get("configSettings")?.scheduler?.available_days_in_future;const{startTime:s,endTime:i,endTimeForAvailableDaysInFuture:a}=this.validateAvailableDaysInFuture(t,n||30);if(s<a&&t.getTime()<a*1e3){const e=await(this.nylasSchedulerConnector?.scheduler.getAvailability(s,i));if(!e||"error"in e){this.nylasSchedulerError.emit({...this.getErrorObject(e?.error)})}}}async bookButtonClickedHandler(e){if(this.rescheduleBookingId){const t=await(this.nylasSchedulerConnector?.scheduler.rescheduleBooking(this.rescheduleBookingId,e.detail));if(!t||"error"in t){this.nylasSchedulerError.emit({...this.getErrorObject(t?.error)})}return}const t=await(this.nylasSchedulerConnector?.scheduler.bookTimeslot(e.detail));if(!t||"error"in t){this.nylasSchedulerError.emit({...this.getErrorObject(t?.error)})}}dateSelectedHandler(e){const t=e.detail;this.selectedDateLabel=t?t.toLocaleDateString(undefined,{dateStyle:"full"}):"No date selected"}cancelBookedEventErrorHandler(e){this.nylasSchedulerError.emit({...this.getErrorObject(e.detail.error)})}cancelBookedEventValidationErrorHandler(e){this.nylasSchedulerError.emit({...this.getErrorObject(e.detail.error)})}rescheduleBookedEventErrorHandler(e){this.nylasSchedulerError.emit({...this.getErrorObject(e.detail.error)})}async getNylasSchedulerStore(){return this.baseProvider?.getStore("scheduler")}async getNylasSchedulerConnector(){return this.nylasSchedulerConnector}async getRef(){return this.host}getErrorObject(e){return{title:e?.title||y.title,category:e?.category||y.category,type:r.Error,description:e?.message||"",id:(new Date).getTime().toString(),ttl:"none"}}checkIfSessionIdOrConfigIdExists(){if(!this.sessionId&&!this.configurationId){this.nylasSchedulerError.emit({title:"No sessionId!",category:p.Component,type:r.Error,description:"Session ID is required",id:(new Date).getTime().toString(),ttl:"none"});return false}return true}isTimeslotValid(e){const t=new Date(e.start_time);if(t<new Date){this.nylasSchedulerError.emit({title:"Invalid tiemslot!",category:p.Component,type:r.Error,description:"The selected timeslot is invalid.",id:(new Date).getTime().toString(),ttl:"none"});return false}return true}validateAvailableDaysInFuture(e,t){const n=new Date;const s=new Date(e.getFullYear(),e.getMonth(),1).getTime()/1e3;const i=new Date(e.getFullYear(),e.getMonth()+1,1).getTime()/1e3;const a=Math.floor(d(n,t).getTime()/1e3);const o=Math.min(a,i);return{startTime:s,endTime:o,endTimeForAvailableDaysInFuture:a}}render(){const t=this.mode==="app";const n=this.baseProvider?.getStore("scheduler");const s=n?.get("eventInfo");const a=n?.get("showBookingForm");const o=n?.get("cancelledEventInfo");const r=n?.get("cancelBookingId")||this.cancelBookingId;const l=n?.get("selectedTimeslot");const d=n?.get("rescheduleBookingId")||this.rescheduleBookingId;const c=n?.get("nylasBranding")||this.nylasBranding;if(t&&r&&!o){return e(i,null,e(g,{nylasBranding:c,isLoading:this.isLoading,showNotification:this.showNotification},e("div",{class:"cancel-flow-page",part:"cancel-flow-page"},e("nylas-cancel-booking-form",{cancelBookingId:r,exportparts:"ncbf, ncbf__input-textfield, ncbf__button-cta, ncbf__button-outline, ncbf__input-label"}))))}if(t&&o){return e(i,null,e(g,{nylasBranding:c,isLoading:this.isLoading,showNotification:this.showNotification},e("div",{class:"cancelled-event-page",part:"cancelled-event-page"},e("nylas-cancelled-event-card",{cancelledEventInfo:o,exportparts:"ncec, ncec__icon, ncec__title, ncec__description, ncec__button-outline, ncec__card"}))))}if(t&&s){return e(i,null,e(g,{nylasBranding:c,isLoading:this.isLoading,showNotification:this.showNotification},e("div",{class:"booked-event-page",part:"booked-event-page"},e("nylas-booked-event-card",{selectedTimeslot:l,eventInfo:s,exportparts:"nbec, nbec__title, nbec__card, nbec__description, nbec__button-outline, nbec__cancel-cta, nbec__reschedule-cta"}))))}if(t&&(!s||!!d)&&!a){const t=this.host.querySelector('[slot="timeslot-picker-cta-label"]');return e(i,null,e(g,{nylasBranding:c,isLoading:this.isLoading,showNotification:this.showNotification},d&&e(f,null,"Choose another time slot to reschedule your meeting"),e("div",{class:"select-date-page",part:"select-date-page"},e("div",{class:"left-panel"},e("nylas-date-picker",{exportparts:"ndp, ndp__month-header, ndp__month-button, ndp__day, ndp__date, ndp__date--selected, ndp__date--current-day, ndp__date--current-month"}),e("div",{class:"border"}),e("nylas-locale-switch",null)),e("div",{class:"right-panel"},e("h2",null,e("calendar-icon",null),e("span",{id:"selectedDate"},this.selectedDateLabel)),e("nylas-timeslot-picker",{exportparts:"ntp, ntp__timeslot, ntp__timeslot--selected, ntp__button-primary"},t&&e("span",{slot:"timeslot-picker-cta-label"},e("slot",{name:"timeslot-picker-cta-label"})))))))}if(t&&!s&&a){const t=this.host.querySelector('[slot="custom-booking-form"]');return e(i,null,e(g,{nylasBranding:c,isLoading:this.isLoading,showNotification:this.showNotification},d&&e(f,null,"Choose another time slot to reschedule your meeting"),e("div",{class:"additional-data-page",part:"additional-data-page"},e("div",{class:"left-panel"},e("div",{class:"wrapper"},e("nylas-selected-event-card",{exportparts:"nsec, nsec__card, nsec__icon, nsec__date, nsec__time"}))),e("div",{class:"right-panel"},e("nylas-booking-form",{exportparts:"nbf, nbf__input-label, nbf__input-textfield, nbf__button-ghost, nbf__button-primary, nbf__button-outline"},t&&e("div",{slot:"custom-booking-form"},e("slot",{name:"custom-booking-form"})))))))}return e(i,null,e("slot",null))}get host(){return a(this)}static get watchers(){return{bookingInfo:["bookingInfoChanged"]}}};v.style=m;export{v as nylas_scheduling};
//# sourceMappingURL=p-8ffc644d.entry.js.map