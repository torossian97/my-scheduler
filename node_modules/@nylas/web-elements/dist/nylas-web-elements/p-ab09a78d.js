import{a as e}from"./p-01e86103.js";import{c as t}from"./p-cabb2e68.js";var i;(function(e){e["Component"]="component";e["Api"]="api";e["Auth"]="auth"})(i||(i={}));var n;(function(e){e["endtime_not_in_future"]="endtime_not_in_future";e["no_booking_info"]="no_booking_info";e["no_timeslot_selected"]="no_timeslot_selected";e["no_timezone_selected"]="no_timezone_selected";e["no_booking_id"]="no_booking_id";e["invalid_start_time"]="invalid_start_time";e["invalid_end_time"]="invalid_end_time";e["invalid_timezone"]="invalid_timezone"})(n||(n={}));var s;(function(e){e["invalid_session"]="invalid_session";e["general_error"]="general_error";e["internal_error"]="internal_error";e["invalid_request_error"]="invalid_request_error";e["timeslot_not_available"]="timeslot_not_available"})(s||(s={}));class o{constructor(){this.component=e=>{const t=i.Component;const n=`${e} error`;return{endtime_not_in_future:(e='"endtime" can not be in the future')=>({title:n,message:e,category:t}),no_booking_info:(e="No booking info provided")=>({title:n,message:e,category:t}),no_timeslot_selected:(e="No timeslot selected")=>({title:n,message:e,category:t}),no_timezone_selected:(e="No timezone selected")=>({title:n,message:e,category:t}),no_booking_id:(e="No booking id provided")=>({title:n,message:e,category:t}),invalid_start_time:(e="Invalid start time")=>({title:n,message:e,category:t}),invalid_end_time:(e="Invalid end time")=>({title:n,message:e,category:t}),invalid_timezone:(e="Invalid timezone")=>({title:n,message:e,category:t})}};this.api=e=>{const t=i.Api;const n=`${e} error`;return{invalid_session:e=>({title:n,message:e,category:t}),general_error:e=>({title:n,message:e,category:t}),internal_error:e=>({title:n,message:e,category:t}),invalid_request_error:e=>({title:n,message:e,category:t}),timeslot_not_available:e=>({title:n,message:e,category:t})}}}}class a{constructor({schedulerAPIURL:e,schedulerStore:t,sessionId:i,configId:n}){this.errors=new o;this.schedulerStore=t;this.schedulerAPIURL=e;this.sessionId=i;this.configId=n}getHeaders(){return!this.configId?{Authorization:`Bearer ${this.sessionId}`}:{}}async makeAPIRequest(e,t,i,n={}){try{const s=new URL(this.schedulerAPIURL);s.pathname=e;const o=await fetch(decodeURIComponent(s.toString()),{method:t,headers:{"Content-Type":"application/json",Origin:window.location.origin,...n},body:i});const a=await o.json();return a}catch(e){return{error:{message:e.message,title:"API request failed",type:"api"}}}}selectDate(e){this.schedulerStore.set("selectedDate",e);this.schedulerStore.set("selectedTimeslot",null)}selectTime(e){this.schedulerStore.set("selectedTimeslot",e)}selectTimezone(e){this.schedulerStore.set("selectedTimezone",e)}toggleAdditionalData(e){this.schedulerStore.set("showBookingForm",e)}setParticipantName(e){const{bookingInfo:t}=this.schedulerStore.state;this.schedulerStore.set("bookingInfo",{...t,primaryParticipant:{...t?.primaryParticipant,name:e}})}setParticipantEmail(e){const{bookingInfo:t}=this.schedulerStore.state;this.schedulerStore.set("bookingInfo",{...t,primaryParticipant:{...t?.primaryParticipant,email:e}})}async resetStoreStateAndFetchAvailability(){const e=new Date;const t=new Date(e.getFullYear(),e.getMonth(),1).getTime()/1e3;const i=new Date(e.getFullYear(),e.getMonth()+1,1).getTime()/1e3;const n=await this.getAvailability(t,i);const s=this.schedulerStore.get("availability").find((e=>new Date(e.start_time)>new Date));let o=e;if(s){o=s.start_time}this.schedulerStore.set("selectedDate",o);this.schedulerStore.set("eventInfo",null);this.schedulerStore.set("showBookingForm",false);this.schedulerStore.set("selectedTimeslot",null);return n}async setReschedule(e){const t=await this.resetStoreStateAndFetchAvailability();this.schedulerStore.set("rescheduleBookingId",e);return t}async setCancel(e){this.schedulerStore.set("cancelBookingId",e)}async resetCancel(){const e=await this.resetStoreStateAndFetchAvailability();this.schedulerStore.set("cancelBookingId","");this.schedulerStore.set("cancelledEventInfo",null);return e}async bookTimeslot(e){this.schedulerStore.set("isLoading",true);const{selectedTimeslot:t,selectedTimezone:i,bookingInfo:n}=this.schedulerStore.state;if(!e&&!n){return{error:this.errors.component("Booking").no_booking_info()}}const s=e?.timeslot||t;if(!s){return{error:this.errors.component("Create Booking").no_timeslot_selected()}}const o=e&&e?.timezone?e?.timezone:i;if(!o){return{error:this.errors.component("Create Booking").no_timezone_selected()}}const a=e?e?.primaryParticipant:n?.primaryParticipant;const r=e?e?.guests||[]:n?.guests||[];const c=e?{...e?.additionalFields,guests:r}:{...n?.additionalFields,guests:r};const l=this.getHeaders();const d=this.configId?`?configuration_id=${this.configId}`:"";const h=`/v3/scheduling/bookings${d}`;const g=await this.makeAPIRequest(decodeURIComponent(h),"POST",JSON.stringify({additional_fields:c,guest:{...a},start_time:s.start_time.getTime()/1e3,end_time:s.end_time.getTime()/1e3,timezone:o}),l);if("error"in g){this.schedulerStore.set("isLoading",false);const e=g.error?.type;let t=g.error;if(e&&e in this.errors.api("Create Booking")){t=this.errors.api("Create Booking")[e](t?.message||t?.title||"Something went wrong")}return{error:t}}if("data"in g){this.schedulerStore.set("eventInfo",g?.data)}this.schedulerStore.set("isLoading",false);return g}async getUISettings(){this.schedulerStore.set("isLoading",true);const e=this.getHeaders();const t=this.configId?`?configuration_id=${this.configId}`:"";const i=`/v3/scheduling/ui-settings${t}`;const n=await this.makeAPIRequest(i,"GET",undefined,e);if("error"in n){this.schedulerStore.set("isLoading",false);const e=n.error?.type;let t=n.error;if(e&&e in this.errors.api("Get UI Settings")){t=this.errors.api("Get UI Settings")[e](t?.message||t?.title||"Something went wrong")}return{error:t}}if("data"in n){this.schedulerStore.set("configSettings",n.data)}this.schedulerStore.set("isLoading",false);return n}async getAvailability(e=0,t=0){this.schedulerStore.set("isLoading",true);const i=new URLSearchParams;const n=new Date;const s=n.getTime();if(t&&t<s/1e3){this.schedulerStore.set("isLoading",false);const e=this.errors.component("Get Availability").endtime_not_in_future();return{error:e}}if(!e){const t=new Date(n.getFullYear(),n.getMonth(),1);e=Math.floor(t.getTime()/1e3)}if(!t){const e=new Date(n.getFullYear(),n.getMonth()+1,0);t=Math.floor(e.getTime()/1e3)}i.append("start_time",encodeURIComponent(e.toString()));i.append("end_time",encodeURIComponent(t.toString()));if(this.configId){i.append("configuration_id",encodeURIComponent(this.configId))}const o=i.toString();const a=`/v3/scheduling/availability${o?`?${o}`:""}`;const r=this.getHeaders();const c=await this.makeAPIRequest(decodeURIComponent(a),"GET",undefined,r);if("error"in c){this.schedulerStore.set("availability",[]);this.schedulerStore.set("isLoading",false);const e=c.error?.type;let t=c.error;if(e&&e in this.errors.api("Get Availability")){t=this.errors.api("Get Availability")[e](t?.message||t?.title||"Something went wrong")}return{error:t}}if("data"in c){const e=c.data?.time_slots?.map((e=>({...e,start_time:new Date(e.start_time*1e3),end_time:new Date(e.end_time*1e3)})))||[];const t=e.filter((e=>e.start_time.getTime()>s));this.schedulerStore.set("availability",t)}this.schedulerStore.set("isLoading",false);return c}async cancelBooking(e){this.schedulerStore.set("isLoading",true);if(!e){return{error:this.errors.component("Cancel Booking").no_booking_id()}}const t=this.configId?`?configuration_id=${this.configId}`:"";const i=`/v3/scheduling/bookings/${e}${t}`;const n=this.getHeaders();const s=await this.makeAPIRequest(decodeURIComponent(i),"DELETE",JSON.stringify({action:"cancel"}),n);if("error"in s){this.schedulerStore.set("isLoading",false);const e=s.error?.type;let t=s.error;if(e&&e in this.errors.api("Cancel Booking")){t=this.errors.api("Cancel Booking")[e](t?.message||t?.title||"Something went wrong")}return{error:t}}this.schedulerStore.set("cancelledEventInfo",{booking_id:e});this.schedulerStore.set("isLoading",false);return s}async rescheduleBooking(e,t){this.schedulerStore.set("isLoading",true);if(!e){return{error:this.errors.component("Reschedule Booking").no_booking_id()}}const i=this.errors.api("Reschedule Booking");const n=this.errors.component("Reschedule Booking");const{bookingInfo:s,selectedTimeslot:o,selectedTimezone:a}=this.schedulerStore.state;const{startTime:r,endTime:c,timezone:l}=t;const d=r||o?.start_time;if(!d){return{error:n.invalid_start_time('Please pass "startTime" in data or set "selectedTimeslot" in the defaultSchedulerState.')}}const h=c||o?.end_time;if(!h){return{error:n.invalid_end_time('Please pass "endTime" in data or set "selectedTimeslot" in the defaultSchedulerState.')}}const g=l||a;if(!g){return{error:n.invalid_timezone('Please pass "timezone" in data or set "selectedTimezone" in the defaultSchedulerState.')}}const m=t?t?.primaryParticipant:s?.primaryParticipant;const u=t?t?.guests||[]:s?.guests||[];const f=t?{...t?.additionalFields,guests:u}:{...s?.additionalFields,guests:u};const _=this.configId?`?configuration_id=${this.configId}`:"";const v=`/v3/scheduling/bookings/${e}${_}`;const y=this.getHeaders();const b=await this.makeAPIRequest(decodeURIComponent(v),"PATCH",JSON.stringify({start_time:d.getTime()/1e3,end_time:h.getTime()/1e3,time_zone:g,additional_fields:f,guest:{...m}}),y);if("error"in b){this.schedulerStore.set("isLoading",false);const e=b.error?.type;let t=b.error;if(e&&e in i){t=i[e](t?.message||t?.title||"Something went wrong")}}if("data"in b)this.schedulerStore.set("eventInfo",b?.data);this.schedulerStore.set("isLoading",false);return b}}function r(i={}){const n={selectedDate:null,selectedLanguage:navigator.language,selectedTimezone:Intl.DateTimeFormat().resolvedOptions().timeZone,selectedTimeslot:null,showBookingForm:false,selectableDates:null,availability:[],state:"ready",eventInfo:null,cancelledEventInfo:null,isLoading:false,nylasBranding:true,...i};e(`[defaultNylasStoreState]: `,n);const s=t(n);s.onChange("availability",(t=>{e(`[availability]: `,t);const i=t.map((e=>e.start_time));e(`[selectableDates]: `,i);s.set("selectableDates",i)}));s.reset=()=>{for(const e in n){const t=n[e];s.set(e,t)}};return s}export{r as C,i as E,a as N};
//# sourceMappingURL=p-ab09a78d.js.map